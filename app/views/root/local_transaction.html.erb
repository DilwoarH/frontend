<%= render layout: 'base_page', locals: {
  title: @publication.title,
  publication: @publication,
  edition: @edition,
  json_link: publication_path(@publication.slug, edition: @edition, format: :json, all: true),
} do %>

  <% if @interaction_details['local_interaction'] %>
    <div class="interaction">
      <p class="interaction-match">
        We've matched this postcode to <span class="local-authority">the <%= @interaction_details['local_authority']['name'] %>.</span>
      </p>
      <p id="get-started" class="get-started group">
        <a href="<%= @interaction_details['local_interaction']['url'] %>" rel="external" class="button" role="button">
          Go to their website
        </a>
      </p>
    </div>

  <% elsif @location_error && @location_error.no_location_interaction? %>

    <div class="application-notice help-notice">
      <p><%= t(@location_error.message, @location_error.message_args) %></p>
    </div>

  <% else %>
    <%= render :partial => 'location_form', :locals => {:format => 'service'} %>
  <% end %>

  <% if @interaction_details['local_authority'] %>
    <% authority = @interaction_details['local_authority'] %>
    <div class="contact vcard">
      <p class="search-again"><%= link_to 'Back', publication_path(@publication.slug) %></p>

      <% unless @interaction_details['local_interaction'] %>
        <% if authority['contact_address'] %>
          <div class="adr"><%= simple_format authority['contact_address'].join("\n") %></div>
        <% end %>
        <% if authority['contact_phone'].present? %>
          <p class="tel"><strong>Telephone:</strong> <span class="value"><%= authority['contact_phone'] %></span></p>
        <% end %>
      <% end %>
    </div>
  <% end %>

  <section class="more">

  <% if @publication.need_to_know.present? %>
    <h2>What you need to know</h2>
    <%= raw @publication.need_to_know %>
  <% end %>
    <div class="more">
      <%= raw @publication.more_information %>
    </div>
  </section>
<% end %>

<% if @location_error && @location_error.postcode_error%>
  <script type="text/javascript">
      GOVUK.analytics.trackEvent(
        "userAlerts:LocalTransaction",
        "postcodeErrorShown:<%= @location_error.postcode_error %>",
        {
          label: "<%= t(@location_error.message, @location_error.message_args) %>"
        }
      );
  </script>
<% end %>
